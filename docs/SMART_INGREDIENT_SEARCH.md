# Smart Ingredient Search - Universal Resolve Pattern

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**–û–¥–∏–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π endpoint** –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞–±–æ—Ç—ã —Å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏:
- –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —á–µ—Ä–µ–∑ AI
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

## UX Scenarios

### 1Ô∏è‚É£ –ï—Å—Ç—å —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: "—Ä–∏—Å"

Dropdown –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
‚îú‚îÄ –†–∏—Å –±–µ–ª—ã–π
‚îú‚îÄ –†–∏—Å –±–∞—Å–º–∞—Ç–∏
‚îî‚îÄ –†–∏—Å –∂–∞—Å–º–∏–Ω

‚ûï –í—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞—Ç—å ¬´—Ä–∏—Å¬ª

üëâ –ö–ª–∏–∫ –Ω–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Üí –≤—ã–±–æ—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
üëâ –ö–ª–∏–∫ "–°–æ–∑–¥–∞—Ç—å" ‚Üí AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è + —Å–æ–∑–¥–∞–Ω–∏–µ
```

### 2Ô∏è‚É£ –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: "–∫–∏–Ω–æ–∞"

‚ö†Ô∏è –ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
AI —Å–æ–∑–¥–∞—Å—Ç –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø—Ä–æ–¥—É–∫—Ç

‚ûï –°–æ–∑–¥–∞—Ç—å ¬´–∫–∏–Ω–æ–∞¬ª

üëâ –ö–ª–∏–∫ ‚Üí POST /resolve ‚Üí AI —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç
```

### 3Ô∏è‚É£ –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: "–ª–æ—Å–æ—Å—å"

‚ö†Ô∏è –ü–æ—Ö–æ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã:
‚Ä¢ –õ–æ—Å–æ—Å—å —Å–≤–µ–∂–∏–π
‚Ä¢ –õ–æ—Å–æ—Å—å —Ñ–µ—Ä–º–µ—Ä—Å–∫–∏–π
‚Ä¢ –õ–æ—Å–æ—Å—å –∫–æ–ø—á—ë–Ω—ã–π

‚ûï –í—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞—Ç—å ¬´–ª–æ—Å–æ—Å—å¬ª

üëâ –ö–ª–∏–∫ –Ω–∞ –ø–æ—Ö–æ–∂–∏–π ‚Üí –≤—ã–±–æ—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
üëâ –ö–ª–∏–∫ "–°–æ–∑–¥–∞—Ç—å" ‚Üí AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ
```

## Technical Implementation

### Frontend Component

**`IngredientAutocomplete.tsx`** - –£–º–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∏–Ω–ø—É—Ç

```tsx
<IngredientAutocomplete
  value={searchValue}
  onChange={(value) => setSearchValue(value)}
  onSelect={(ingredient) => handleSelect(ingredient)}
  onCreateNew={(input) => handleCreate(input)}
  language={language}
/>
```

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `value` - —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫
- `suggestions` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞ (debounce 300ms)
- `showDropdown` - –ø–æ–∫–∞–∑ dropdown (min 2 —Å–∏–º–≤–æ–ª–∞)
- `loading` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏

**Dropdown —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
1. –°–ø–∏—Å–æ–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
2. –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
3. –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å" (–≤—Å–µ–≥–¥–∞)

### API Layer

#### 1. Autocomplete Endpoint (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)

```
GET /api/admin/ingredients/suggest?q=–ª–æ—Å–æ—Å—å&limit=5

Response:
{
  "suggestions": [
    { id, name, nameRu, category, unit, ... }
  ]
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** Debounced –ø–æ–∏—Å–∫ –¥–ª—è dropdown

#### 2. Universal Resolve Endpoint (–Ω–æ–≤—ã–π)

```
POST /api/admin/ingredients/resolve

Body:
{
  "input": "–ª–æ—Å–æ—Å—å"
}

Response:
{
  "status": "created" | "existing",
  "ingredient": {
    "id": "uuid-123",
    "name": "–õ–æ—Å–æ—Å—å",
    "nameRu": "–õ–æ—Å–æ—Å—å",
    "namePl": "≈Åoso≈õ",
    "nameEn": "Salmon",
    "category": "fish",
    "nutritionGroup": "protein",
    "unit": "g"
  }
}
```

**Backend –ª–æ–≥–∏–∫–∞:**

```python
def resolve_ingredient(input: str):
    # 1. Normalize input
    normalized = normalize(input)
    
    # 2. Check if exists
    existing = db.find_by_normalized(normalized)
    if existing:
        return {"status": "existing", "ingredient": existing}
    
    # 3. AI Classification
    ai_result = classify_with_ai(input)
    # AI determines:
    # - category (fish, meat, vegetable, ...)
    # - nutritionGroup (protein, carbs, fat, ...)
    # - unit (g, ml, pcs, ...)
    # - translations (nameRu, namePl, nameEn)
    
    # 4. Create and save
    new_ingredient = db.create(
        name=ai_result.name,
        nameRu=ai_result.nameRu,
        namePl=ai_result.namePl,
        nameEn=ai_result.nameEn,
        category=ai_result.category,
        nutritionGroup=ai_result.nutritionGroup,
        unit=ai_result.unit,
        normalizedValue=normalized
    )
    
    return {"status": "created", "ingredient": new_ingredient}
```

### Frontend Integration

**–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `CreateRecipeWithAI.tsx`:**

```tsx
const handleCreateNewIngredient = async (index: number, input: string) => {
  setCreatingIngredient(true);
  try {
    // –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ - –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –¥–µ–ª–∞–µ—Ç backend
    const result = await resolveIngredient(input);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
    setIngredients(prev => prev.map((ing, i) => 
      i === index ? {
        ...ing,
        ingredientId: result.ingredient.id,
        name: result.ingredient.nameRu || result.ingredient.name,
        unit: result.ingredient.unit,
        searchValue: ""
      } : ing
    ));

    // User feedback
    if (result.status === "created") {
      toast.success(`–ü—Ä–æ–¥—É–∫—Ç —Å–æ–∑–¥–∞–Ω: ${result.ingredient.name}`);
    } else {
      toast.info(`–ü—Ä–æ–¥—É–∫—Ç –Ω–∞–π–¥–µ–Ω: ${result.ingredient.name}`);
    }
  } catch (error) {
    toast.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç");
  } finally {
    setCreatingIngredient(false);
  }
};
```

**–ù–∏–∫–∞–∫–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤, –Ω–∏–∫–∞–∫–∏—Ö —Ñ–æ—Ä–º!** –ü—Ä–æ—Å—Ç–æ –æ–¥–∏–Ω –∫–ª–∏–∫ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

## AI Classification Pipeline

Backend –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

### 1. Prompt –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

```
You are an ingredient classification AI.
Given an ingredient name in any language, classify it:

Input: "–ª–æ—Å–æ—Å—å"

Output JSON:
{
  "name": "–õ–æ—Å–æ—Å—å",
  "nameRu": "–õ–æ—Å–æ—Å—å",
  "namePl": "≈Åoso≈õ", 
  "nameEn": "Salmon",
  "category": "fish",
  "nutritionGroup": "protein",
  "unit": "g"
}

Categories: fish, meat, egg, vegetable, fruit, dairy, grain, pasta, bread, condiment, spice, herb, nut, seed, oil, sauce, beverage, sweet, legume, cheese, seafood, other

Nutrition Groups: protein, carbohydrate, fat, vegetable, fruit, dairy, other

Units: g, ml, pcs, tbsp, tsp, cup
```

### 2. Normalization

```python
def normalize(input: str) -> str:
    return (
        input
        .lower()
        .strip()
        .replace(' ', '')
        .replace('-', '')
        # –£–±—Ä–∞—Ç—å –¥–∏–∞–∫—Ä–∏—Ç–∏–∫—É
        # –£–±—Ä–∞—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
    )
```

### 3. Deduplication Check

```sql
SELECT * FROM ingredients 
WHERE normalized_value = :normalized
LIMIT 1;
```

–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –≤–µ—Ä–Ω—É—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
–ï—Å–ª–∏ –Ω–µ—Ç ‚Üí AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π

## Benefits

### ‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π UX
- –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –º–æ–¥–∞–ª–æ–∫
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –ª–æ–≥–∏–∫–∞

### ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ Frontend
- –û–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `IngredientAutocomplete`
- –û–¥–∏–Ω –º–µ—Ç–æ–¥ `resolveIngredient()`
- –ù–∏–∫–∞–∫–æ–π —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏

### ‚úÖ –í—Å—è –ª–æ–≥–∏–∫–∞ –Ω–∞ Backend
- AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ü–µ—Ä–µ–≤–æ–¥—ã
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è

### ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–π —Ñ–æ—Ä–º–µ
- Recipe creation
- Fridge management
- Market lists

## Files Created/Modified

### ‚úÖ Frontend

**–°–æ–∑–¥–∞–Ω–æ:**
- `/components/admin/recipes/IngredientAutocomplete.tsx` - –£–º–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∏–Ω–ø—É—Ç
- `/lib/api/ingredients.api.ts` - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `resolveIngredient()`
- `/app/api/admin/ingredients/resolve/route.ts` - Proxy endpoint

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
- `/components/admin/recipes/CreateRecipeWithAI.tsx` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

### ‚è≥ Backend (—Ç—Ä–µ–±—É–µ—Ç—Å—è)

**–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å:**
- `POST /admin/ingredients/resolve` - Universal resolution endpoint
- AI classification service
- Normalization utils
- Deduplication check

## Testing

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å dev server
npm run dev

# 2. –û—Ç–∫—Ä—ã—Ç—å
http://localhost:3000/admin/recipes/create

# 3. –¢–µ—Å—Ç-–∫–µ–π—Å—ã:

## Scenario 1: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–¥—É–∫—Ç
–í–≤–µ—Å—Ç–∏: "—Ä–∏—Å"
‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫
‚úÖ –ö–ª–∏–∫ –Ω–∞ "–†–∏—Å –±–µ–ª—ã–π" ‚Üí –≤—ã–±—Ä–∞–Ω
‚úÖ –ö–ª–∏–∫ "–°–æ–∑–¥–∞—Ç—å ¬´—Ä–∏—Å¬ª" ‚Üí —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π (–µ—Å–ª–∏ –±—ç–∫ –≥–æ—Ç–æ–≤)

## Scenario 2: –ù–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç
–í–≤–µ—Å—Ç–∏: "–∫–∏–Ω–æ–∞"
‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å "–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"
‚úÖ –ö–ª–∏–∫ "–°–æ–∑–¥–∞—Ç—å ¬´–∫–∏–Ω–æ–∞¬ª" ‚Üí POST /resolve
‚úÖ Backend —Å–æ–∑–¥–∞–µ—Ç —á–µ—Ä–µ–∑ AI
‚úÖ –ü—Ä–æ–¥—É–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ñ–æ—Ä–º—É

## Scenario 3: –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
–í–≤–µ—Å—Ç–∏: "–ª–æ—Å–æ—Å—å"
‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Ö–æ–∂–∏–µ
‚úÖ –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞
‚úÖ –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
```

## Next Steps

1. **Backend**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `/admin/ingredients/resolve`
2. **AI**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å prompt –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. **Testing**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ 3 —Å—Ü–µ–Ω–∞—Ä–∏—è
4. **Optimization**: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ AI —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
5. **Analytics**: –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ AI –ø—Ä–æ–¥—É–∫—Ç—ã

## Status

- ‚úÖ Frontend component –≥–æ—Ç–æ–≤
- ‚úÖ API route –≥–æ—Ç–æ–≤
- ‚úÖ Integration –≤ CreateRecipeWithAI –≥–æ—Ç–æ–≤
- ‚è≥ Backend endpoint —Ç—Ä–µ–±—É–µ—Ç—Å—è
- ‚è≥ AI classification —Ç—Ä–µ–±—É–µ—Ç—Å—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 7 —è–Ω–≤–∞—Ä—è 2026  
**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**Pattern:** Universal Resolve Pattern
