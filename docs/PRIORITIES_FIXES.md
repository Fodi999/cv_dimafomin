# ๐ฅ ะะะะะะะขะะขะซ ะะกะะะะะะะะะ

**ะะฐัะฐ:** 16 ัะฝะฒะฐัั 2026  
**ะกัะฐััั:** Roadmap

---

## โ ะงะขะ ะฃะะ ะะกะะะะะะะะ

### 1. ะฏะทัะบ = Backend Source of Truth โ

**ะัะพะฑะปะตะผะฐ:**
```
โ Cookie ะธ backend ะฝะต ัะธะฝััะพะฝะธะทะธัะพะฒะฐะฝั
โ UI ะฟะพะบะฐะทัะฒะฐะตั ะพะดะธะฝ ัะทัะบ, AI ะธัะฟะพะปัะทัะตั ะดััะณะพะน
```

**ะะตัะตะฝะธะต:**
```
โ SettingsContext ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะธะฝััะพะฝะธะทะธััะตั backend โ cookie
โ ะัะธ ะฝะตัะพะฒะฟะฐะดะตะฝะธะธ: ะพะฑะฝะพะฒะธัั cookie + reload
โ LanguageSwitcher: backend first โ loadSettings โ UI
```

**ะคะฐะนะปั:**
- `contexts/SettingsContext.tsx` - ะดะพะฑะฐะฒะปะตะฝะฐ ะฐะฒัะพะผะฐัะธัะตัะบะฐั ัะธะฝััะพะฝะธะทะฐัะธั
- `components/LanguageSwitcher.tsx` - ะฟัะฐะฒะธะปัะฝัะน ะฟะพัะพะบ (ัะถะต ะฑัะป)
- `docs/LANGUAGE_ARCHITECTURE.md` - ะฟะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
- `docs/LANGUAGE_BACKEND_FIRST.md` - ะบัะฐัะบะฐั ะธะฝััััะบัะธั

**ะกัะฐััั:** โ Production Ready

---

## ๐ฅ ะงะขะ ะะฃะะะ ะะกะะะะะะขะฌ ะกะะะงะะ

### ะจะฐะณ 1: JWT ะฑะตะท `sub` โ ะะะะขะะงะะ

**ะัะพะฑะปะตะผะฐ:**
```typescript
// ะขะตะบััะธะน JWT payload:
{
  email: "fodi85@gmail.ru",
  role: "home_chef",
  sub: undefined  // โ ะะะะขะะงะะ
}
```

**ะะพัะตะผั ััะพ ะฟัะพะฑะปะตะผะฐ:**
1. **ะะตั ััะฐะฑะธะปัะฝะพะณะพ user ID** โ React ะดัะผะฐะตั, ััะพ ะฟะพะปัะทะพะฒะฐัะตะปั ยซะฝะพะฒัะนยป ะฟัะธ ะบะฐะถะดะพะน ะทะฐะณััะทะบะต
2. **RecipeContext ะพัะธัะฐะตั localStorage** โ `๐๏ธ RecipeContext: Cleared localStorage` ะฟัะธ ะบะฐะถะดะพะผ ัะตะฝะดะตัะต
3. **ะะตะปัะทั ะผะฐัััะฐะฑะธัะพะฒะฐัััั** โ ะฝะตั ัะฟะพัะพะฑะฐ ัะฒัะทะฐัั ะดะฐะฝะฝัะต ั ะบะพะฝะบัะตัะฝัะผ ะฟะพะปัะทะพะฒะฐัะตะปะตะผ

**ะะตัะตะฝะธะต:**
```go
// Backend (Go): ะ JWT ะดะพะฑะฐะฒะธัั sub = user.id

token := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{
  "sub":   user.ID,          // ๐ฅ ะะะะะะะขะฌ ะญะขะ
  "email": user.Email,
  "role":  user.Role,
  "exp":   time.Now().Add(24 * time.Hour).Unix(),
})
```

**Frontend ะฟัะพะฒะตัะบะฐ:**
```typescript
// TokenValidator.tsx
console.log("Token payload:", {
  sub: payload.sub,      // ะะพะปะถะตะฝ ะฑััั ัะธัะปะพะผ (user ID)
  email: payload.email,
  role: payload.role,
});
```

**ะัะธะพัะธัะตั:** ๐ฅ๐ฅ๐ฅ ะะะะขะะงะะ  
**ะะฐะฒะธัะธะผะพััะธ:** ะัะต ะบะพะฝัะตะบััั, ะบะพัะพััะต ะธัะฟะพะปัะทััั userId  
**ะกัะฐััั:** โ ะะ ะะกะะะะะะะะ

---

### ะจะฐะณ 2: RecipeContext ะพัะธัะฐะตั localStorage ะฟะพััะพัะฝะฝะพ โ

**ะัะพะฑะปะตะผะฐ:**
```
๐๏ธ RecipeContext: Cleared localStorage
๐๏ธ RecipeContext: Cleared localStorage
๐๏ธ RecipeContext: Cleared localStorage
```

**ะะพัะตะผั ััะพ ะฟัะพะธััะพะดะธั:**
```typescript
// RecipeContext.tsx
useEffect(() => {
  if (!userId) {
    // โ userId = undefined ะธะท-ะทะฐ ะพััััััะฒะธั sub ะฒ JWT
    clearLocalStorage();
  }
}, [userId]);
```

**ะะตัะตะฝะธะต:**
```typescript
// ะะพัะปะต ัะธะบัะฐ JWT ั sub:
const userId = user?.id;  // โ ะกัะฐะฑะธะปัะฝัะน ID

// RecipeContext ะฑะพะปััะต ะฝะต ะฑัะดะตั ะพัะธัะฐัั localStorage
```

**ะัะธะพัะธัะตั:** ๐ฅ ะะซะกะะะะ (ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะธััั ะฟะพัะปะต ะจะฐะณะฐ 1)  
**ะะฐะฒะธัะธะผะพััะธ:** ะจะฐะณ 1 (JWT ั sub)  
**ะกัะฐััั:** โณ ะะดัั ัะธะบัะฐ JWT

---

## โ ะงะขะ ะฃะะ ะะะะะขะะะข ะะะะะะะฌะะ

### 1. AI โ
- AI ะฟะพะปััะฐะตั ัะทัะบ ะธะท SettingsContext
- ะัะธ ัะผะตะฝะต ัะทัะบะฐ: loadSettings() โ AI ะธัะฟะพะปัะทัะตั ะฝะพะฒัะน ัะทัะบ

### 2. ะะฐััะธะฝะณ ัะตัะตะฟัะพะฒ โ
- AIRecommendationCard ัะฐะฑะพัะฐะตั ะบะพััะตะบัะฝะพ
- ะัะต ะฟะตัะตะฒะพะดั ะดะพะฑะฐะฒะปะตะฝั (pl, en, ru)

### 3. ะะฐัะฐะปะพะณ ัะตัะตะฟัะพะฒ โ
- RecipesTable ะธัะฟะพะปัะทัะตั useLanguage
- getRecipeName() ะฒะพะทะฒัะฐัะฐะตั ะฟัะฐะฒะธะปัะฝัะน ัะทัะบ

### 4. ะฅะพะปะพะดะธะปัะฝะธะบ โ
- ะคะธะปัััั, ัะพััะธัะพะฒะบะฐ ัะฐะฑะพัะฐัั
- ะะตัะตะฒะพะดั ะฝะฐ 3 ัะทัะบะฐั

### 5. ะฃะฒะตะดะพะผะปะตะฝะธั โ
- NotificationContext ะธัะฟะพะปัะทัะตั ัะทัะบ ะธะท SettingsContext
- ะัะธ ัะผะตะฝะต ัะทัะบะฐ: loadSettings() โ ัะฒะตะดะพะผะปะตะฝะธั ะพะฑะฝะพะฒะปััััั

---

## ๐ ะััะธัะตะบัััะฐ ะะพัะปะต ะัะตั ะคะธะบัะพะฒ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Backend (Go)                     โ
โ                                                     โ
โ  JWT Token:                                         โ
โ  {                                                  โ
โ    "sub": 123,              โ user.id             โ
โ    "email": "user@mail.ru", โ user.email          โ
โ    "role": "home_chef"      โ user.role           โ
โ  }                                                  โ
โ                                                     โ
โ  User Settings:                                     โ
โ  {                                                  โ
โ    "user_id": 123,          โ ััะฐะฑะธะปัะฝัะน ID       โ
โ    "language": "ru",        โ ะธััะพัะฝะธะบ ะธััะธะฝั     โ
โ    "currency": "PLN"                                โ
โ  }                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
                        โ HTTP + JWT
                        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  Frontend (Next.js)                 โ
โ                                                     โ
โ  AuthContext:                                       โ
โ  - token โ                                         โ
โ  - isAuthenticated โ                               โ
โ                                                     โ
โ  UserContext:                                       โ
โ  - user.id โ (ะธะท JWT.sub)                          โ
โ  - user.email โ                                    โ
โ  - user.role โ                                     โ
โ                                                     โ
โ  SettingsContext: (Single Source of Truth)          โ
โ  - settings.language โ (ะธะท backend)                โ
โ  - auto sync cookie โ                              โ
โ                                                     โ
โ  RecipeContext:                                     โ
โ  - userId โ (ััะฐะฑะธะปัะฝัะน)                           โ
โ  - ะะ ะพัะธัะฐะตั localStorage โ                       โ
โ                                                     โ
โ  AI / Notifications / UI:                           โ
โ  - ะธัะฟะพะปัะทััั ัะทัะบ ะธะท SettingsContext โ            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ ะะปะฐะฝ ะะตะนััะฒะธะน

### ะะตะผะตะดะปะตะฝะฝะพ (ะกะตะณะพะดะฝั):

1. **ะะพะฑะฐะฒะธัั `sub` ะฒ JWT ะฝะฐ backend** โ ะะะะขะะงะะ
   ```go
   // handlers/auth.go
   token := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{
     "sub":   user.ID,  // ๐ฅ ะะะะะะะขะฌ
     "email": user.Email,
     "role":  user.Role,
     "exp":   time.Now().Add(24 * time.Hour).Unix(),
   })
   ```

2. **ะัะพะฒะตัะธัั frontend**
   ```bash
   # ะัะบัััั ะบะพะฝัะพะปั ะฑัะฐัะทะตัะฐ
   # ะะพะปะถะฝะพ ะฑััั:
   # โ Token validated: {sub: 123, email: "user@mail.ru", role: "home_chef"}
   ```

3. **ะัะพะฒะตัะธัั RecipeContext**
   ```bash
   # ะะ ะดะพะปะถะฝะพ ะฑััั:
   # ๐๏ธ RecipeContext: Cleared localStorage
   ```

---

### ะ ัะตัะตะฝะธะต ะฝะตะดะตะปะธ:

4. **ะะพะฑะฐะฒะธัั ะผะพะฝะธัะพัะธะฝะณ**
   - ะะพะณะธัะพะฒะฐัั ะฒัะต ัะปััะฐะธ `sub: undefined`
   - ะะปะตัั ะฟัะธ ัะฐััะธะฝััะพะฝะธะทะฐัะธะธ backend.language !== cookie

5. **ะะฐะฟะธัะฐัั ัะตััั**
   - ะขะตัั: JWT ะดะพะปะถะตะฝ ัะพะดะตัะถะฐัั `sub`
   - ะขะตัั: SettingsContext ัะธะฝััะพะฝะธะทะธััะตั cookie
   - ะขะตัั: ะกะผะตะฝะฐ ัะทัะบะฐ ะฟัะพัะพะดะธั ัะตัะตะท backend

6. **ะะฑะฝะพะฒะธัั ะดะพะบัะผะตะฝัะฐัะธั**
   - README: ััะตะฑะพะฒะฐะฝะธั ะบ JWT
   - API docs: ััััะบัััะฐ ัะพะบะตะฝะฐ

---

## ๐ ะัะพะณ

```
โ ะฏะทัะบ = backend source of truth (ะะกะะะะะะะะ)
โ JWT ะฑะตะท sub (ะะะะขะะงะะ, ะขะะะะฃะะข ะคะะะกะ)
โณ RecipeContext ะพัะธัะฐะตั localStorage (ัะตัะธััั ะฟะพัะปะต ัะธะบัะฐ JWT)
โ AI, ัะฒะตะดะพะผะปะตะฝะธั, UI ัะฐะฑะพัะฐัั ะฟัะฐะฒะธะปัะฝะพ
```

**ะกะปะตะดัััะธะน ัะฐะณ:** ะะพะฑะฐะฒะธัั `sub = user.id` ะฒ JWT ะฝะฐ backend

**ะกัะฐััั:** โณ ะะดัะผ ัะธะบัะฐ backend
