# ğŸŒ Language Architecture - ĞĞ´Ğ¸Ğ½ Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ˜ÑÑ‚Ğ¸Ğ½Ñ‹

**Ğ”Ğ°Ñ‚Ğ°:** 16 ÑĞ½Ğ²Ğ°Ñ€Ñ 2026  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… Production Ready

---

## ğŸ¯ Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾Ğµ ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾

```
Backend = Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¸ÑÑ‚Ğ¸Ğ½Ñ‹ Ğ´Ğ»Ñ ÑĞ·Ñ‹ĞºĞ°
UI = ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ, ĞĞ• Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº
Cookie = ĞšĞµÑˆ Ğ´Ğ»Ñ SSR/middleware
```

---

## ğŸ”„ ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞŸĞ¾Ñ‚Ğ¾Ğº

### 1ï¸âƒ£ ĞŸĞµÑ€Ğ²Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° (Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ)

```
1. Middleware Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ cookie (Ğ´Ğ»Ñ SSR) 
   â†“
2. Layout Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ‚ÑÑ Ñ ÑĞ·Ñ‹ĞºĞ¾Ğ¼ Ğ¸Ğ· cookie
   â†“
3. SettingsContext Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ
   â†“
4. GET /api/settings Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ { language: "ru" }
   â†“
5. Ğ•ÑĞ»Ğ¸ backend.language !== cookie:
   â†’ ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ cookie
   â†’ ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ
   â†“
6. âœ… UI, AI, ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ ĞĞ”Ğ˜Ğ ÑĞ·Ñ‹Ğº
```

### 2ï¸âƒ£ Ğ¡Ğ¼ĞµĞ½Ğ° ÑĞ·Ñ‹ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼

```
User clicks "RU"
   â†“
1. PATCH /api/settings { language: "ru" }
   â†“
2. Backend ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² Ğ‘Ğ”
   â†“
3. loadSettings() - Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· backend
   â†“
4. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ cookie
   â†“
5. setLanguage("ru") â†’ window.location.reload()
   â†“
6. âœ… Ğ’ÑÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼ ÑĞ·Ñ‹ĞºĞ¾Ğ¼
```

### 3ï¸âƒ£ Ğ“Ğ¾ÑÑ‚ÑŒ (Ğ½Ğµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½)

```
1. Middleware Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ cookie (default: "pl")
   â†“
2. Layout Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ‚ÑÑ Ñ default ÑĞ·Ñ‹ĞºĞ¾Ğ¼
   â†“
3. SettingsContext: settings = DEFAULT_SETTINGS
   â†“
4. âœ… Ğ“Ğ¾ÑÑ‚ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ default ÑĞ·Ñ‹Ğº (PL)
```

---

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ĞšĞ¾Ğ´Ğ°

### `middleware.ts` - SSR Cache Layer

```typescript
// âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: Cookie ĞºĞ°Ğº ĞºĞµÑˆ Ğ´Ğ»Ñ SSR
const cookieLang = req.cookies.get("app_language")?.value;
const lang = isSupportedLanguage(cookieLang) ? cookieLang : "pl";

res.cookies.set("app_language", lang, {
  path: "/",
  maxAge: 31536000, // 1 Ğ³Ğ¾Ğ´
  sameSite: "lax",
});
```

**Ğ¦ĞµĞ»ÑŒ:** Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ SSR Ğ±ĞµĞ· Ğ¼ĞµÑ€Ñ†Ğ°Ğ½Ğ¸Ñ

---

### `SettingsContext.tsx` - Single Source of Truth

```typescript
/**
 * ğŸ”¥ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ: Backend = Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¸ÑÑ‚Ğ¸Ğ½Ñ‹
 * 
 * Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ backend settings Ñ cookie/localStorage
 */

useEffect(() => {
  if (isAuthenticated && !userIsLoading) {
    loadSettings(); // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ· backend
    
    // ğŸ”¥ ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ cookie
    const cookieLang = getCookie("app_language");
    if (settings.language && settings.language !== cookieLang) {
      // Backend Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ cookie â†’ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ cookie
      setCookie("app_language", settings.language);
      window.location.reload(); // ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ ÑĞ·Ñ‹ĞºĞ¾Ğ¼
    }
  }
}, [isAuthenticated, userIsLoading, settings.language]);
```

**Ğ¦ĞµĞ»ÑŒ:** Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ backend Ğ¸ cookie Ğ²ÑĞµĞ³Ğ´Ğ° ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ÑÑ‚

---

### `LanguageSwitcher.tsx` - UI Control

```typescript
/**
 * âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° backend, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ UI
 */
const handleLanguageChange = async (lang: Language) => {
  // [1] Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² backend (Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¸ÑÑ‚Ğ¸Ğ½Ñ‹)
  await updateSettings({ language: lang });
  
  // [2] ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ· backend (Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)
  await loadSettings();
  
  // [3] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ cookie
  setCookie("app_language", lang);
  
  // [4] ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ UI
  setLanguage(lang); // â†’ window.location.reload()
};
```

**Ğ¦ĞµĞ»ÑŒ:** Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ AI, ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ UI Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ ĞĞ”Ğ˜Ğ ÑĞ·Ñ‹Ğº

---

### `LanguageContext.tsx` - UI State

```typescript
/**
 * âš ï¸ ĞĞ• Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¸ÑÑ‚Ğ¸Ğ½Ñ‹, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ
 */
const setLanguage = (lang: Language) => {
  // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ cookie (Ğ´Ğ»Ñ middleware/SSR)
  setCookie("app_language", lang);
  
  // ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ SSR Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ ÑĞ·Ñ‹ĞºĞ¾Ğ¼)
  window.location.reload();
};
```

**Ğ¦ĞµĞ»ÑŒ:** ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼ ÑĞ·Ñ‹ĞºĞ¾Ğ¼ Ğ¸Ğ· cookie

---

## âœ… ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº

### ĞŸĞµÑ€ĞµĞ´ Ğ²Ñ‹Ğ¿ÑƒÑĞºĞ¾Ğ¼ Ğ² Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞ½:

- [x] Backend Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ `language` Ğ² GET /api/settings
- [x] PATCH /api/settings ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ `language` Ğ² Ğ‘Ğ”
- [x] SettingsContext ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ backend Ñ cookie
- [x] LanguageSwitcher Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `updateSettings â†’ loadSettings â†’ setLanguage`
- [x] Middleware Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ cookie Ğ´Ğ»Ñ SSR
- [x] Layout Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ ÑĞ·Ñ‹Ğº Ğ¸Ğ· cookie Ğ² LanguageProvider
- [x] AI Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ÑĞ·Ñ‹Ğº Ğ¸Ğ· SettingsContext
- [x] Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ ÑĞ·Ñ‹Ğº Ğ¸Ğ· SettingsContext

---

## ğŸ› Ğ§Ğ°ÑÑ‚Ñ‹Ğµ ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

### âŒ ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° 1: AI Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** LanguageSwitcher Ğ½Ğµ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ `loadSettings()` Ğ¿Ğ¾ÑĞ»Ğµ `updateSettings()`

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```typescript
await updateSettings({ language: lang });
await loadSettings(); // ğŸ”¥ ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾!
setLanguage(lang);
```

---

### âŒ ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° 2: Cookie Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ñ backend

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** Cookie ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ² LanguageContext, Ğ¼Ğ¸Ğ½ÑƒÑ backend

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ’ÑĞµĞ³Ğ´Ğ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑŒ Ğ² backend ĞŸĞ•Ğ Ğ’Ğ«Ğœ:
```typescript
// âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ
await updateSettings({ language: lang }); // Backend first
setCookie("app_language", lang);          // Cookie second

// âŒ ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ
setCookie("app_language", lang);          // Cookie first âŒ
await updateSettings({ language: lang }); // Backend second âŒ
```

---

### âŒ ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° 3: Ğ¯Ğ·Ñ‹Ğº Ğ½Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** Backend Ğ½Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ ÑĞ·Ñ‹Ğº Ğ² Ğ‘Ğ” Ğ¸Ğ»Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:**
```bash
# 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
curl -X PATCH http://localhost:3000/api/settings \
  -H "Cookie: token=YOUR_JWT" \
  -H "Content-Type: application/json" \
  -d '{"language":"ru"}'

# 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚
curl -X GET http://localhost:3000/api/settings \
  -H "Cookie: token=YOUR_JWT"
```

**ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚:**
```json
{
  "language": "ru",
  "currency": "PLN",
  ...
}
```

---

## ğŸ“Š Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser                          â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  LanguageSwitcher                   â”‚           â”‚
â”‚  â”‚  User clicks "RU"                   â”‚           â”‚
â”‚  â”‚                                     â”‚           â”‚
â”‚  â”‚  1. updateSettings({ language })    â”‚â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. loadSettings()                  â”‚       â”‚   â”‚
â”‚  â”‚  3. setLanguage()                   â”‚       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚                                                 â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  SettingsContext                    â”‚â—„â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚  (Single Source of Truth)           â”‚           â”‚
â”‚  â”‚                                     â”‚           â”‚
â”‚  â”‚  - settings: { language: "ru" }     â”‚           â”‚
â”‚  â”‚  - loadSettings()                   â”‚â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  - updateSettings()                 â”‚       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚                                                 â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  AI / Notifications / UI            â”‚â—„â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚  use language from SettingsContext  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ HTTP Requests
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Backend API                        â”‚
â”‚                                                     â”‚
â”‚  GET /api/settings                                  â”‚
â”‚  â†’ { language: "ru", currency: "PLN", ... }         â”‚
â”‚                                                     â”‚
â”‚  PATCH /api/settings { language: "ru" }             â”‚
â”‚  â†’ Save to database                                 â”‚
â”‚  â†’ Return updated settings                          â”‚
â”‚                                                     â”‚
â”‚  ğŸ“¦ Database (PostgreSQL)                           â”‚
â”‚     user_settings: { user_id, language, ... }       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹

### 1. **Backend First**
Backend Ğ²ÑĞµĞ³Ğ´Ğ° Ñ€ĞµÑˆĞ°ĞµÑ‚, ĞºĞ°ĞºĞ¾Ğ¹ ÑĞ·Ñ‹Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ. UI Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚.

### 2. **Single Source of Truth**
SettingsContext Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ÑĞ·Ñ‹Ğº Ğ¸Ğ· backend Ğ¸ Ğ´ĞµĞ»Ğ¸Ñ‚ÑÑ Ğ¸Ğ¼ ÑĞ¾ Ğ²ÑĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸ĞµĞ¼.

### 3. **Cookie as Cache**
Cookie Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ´Ğ»Ñ SSR/middleware, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ Ğ¼ĞµÑ€Ñ†Ğ°Ğ½Ğ¸Ñ.

### 4. **Reload on Change**
ĞŸÑ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ ÑĞ·Ñ‹ĞºĞ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº.

### 5. **Sync Check**
ĞŸÑ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼: backend.language === cookie. Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ â†’ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ cookie.

---

## ğŸš€ ĞšĞ°Ğº ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ

### 1. Ğ¡Ğ¼ĞµĞ½Ğ° ÑĞ·Ñ‹ĞºĞ° Ğ² UI

```typescript
// ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ
1. ĞšĞ»Ğ¸ĞºĞ½ÑƒÑ‚ÑŒ "RU" Ğ² LanguageSwitcher
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸:
   âœ… [1/3] Saving language to backend: ru
   âœ… [2/3] Language saved to DB: ru
   âœ… [3/3] Reloading settings from backend...
   âœ… Settings reloaded, AI will use new language: ru
```

### 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

```typescript
// ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ DevTools â†’ Application â†’ Cookies
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ cookie "app_language"
2. ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Network â†’ GET /api/settings
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ response: { "language": "ru" }
4. âœ… Cookie Ğ¸ backend Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°Ñ‚ÑŒ
```

### 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° AI

```typescript
// ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ñ AI
1. Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ½Ğ° RU
2. ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ‡Ğ°Ñ‚ Ñ AI
3. AI Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼
4. âœ… Ğ¯Ğ·Ñ‹Ğº AI ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ñ UI
```

---

## ğŸ“ Ğ˜Ñ‚Ğ¾Ğ³

```
âœ… Backend = Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¸ÑÑ‚Ğ¸Ğ½Ñ‹
âœ… Cookie = ĞºĞµÑˆ Ğ´Ğ»Ñ SSR
âœ… SettingsContext = ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ backend â†” cookie
âœ… AI, ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ, UI Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ ĞĞ”Ğ˜Ğ ÑĞ·Ñ‹Ğº
âœ… Ğ¡Ğ¼ĞµĞ½Ğ° ÑĞ·Ñ‹ĞºĞ° Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ñ‡ĞµÑ€ĞµĞ· backend
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğº Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞ½
