# ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹ â€” Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°

## ğŸ“Š Ğ”Ğ¾ Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° (ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI Assistant Page                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  useAIRecommendation   â”‚
              â”‚  (loads AI recipe)     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  handleRecipeLoaded    â”‚
              â”‚  âŒ saveToRecipeContextâ”‚  â† ĞĞ¨Ğ˜Ğ‘ĞšĞ: ÑĞ¼ĞµÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        RecipeContext                 â”‚
        â”‚  (localStorage - PERSISTENT)         â”‚
        â”‚                                      â”‚
        â”‚  âŒ AI recommendation (ephemeral)    â”‚
        â”‚  âœ… User recipe (persistent)         â”‚
        â”‚                                      â”‚
        â”‚  â†’ ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…!                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  AIRecommendationCard  â”‚
              â”‚  âŒ ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚:        â”‚
              â”‚    - Ğ²ĞµÑÑŒ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ¸Ğ»ÑŒĞ½Ğ¸Ğº  â”‚
              â”‚    - 0 missing         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… ĞŸĞ¾ÑĞ»Ğµ Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° (ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI Assistant Page                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  useAIRecommendation   â”‚
              â”‚  (loads AI decision)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                     â”‚
        â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AIRecommendationCtx  â”‚        â”‚   RecipeContext      â”‚
â”‚ (EPHEMERAL)          â”‚        â”‚   (PERSISTENT)       â”‚
â”‚                      â”‚        â”‚                      â”‚
â”‚ âœ… AI decision       â”‚        â”‚ âœ… User recipe       â”‚
â”‚ âœ… Scenario          â”‚        â”‚ âœ… Saved recipes     â”‚
â”‚ âœ… Temporary state   â”‚        â”‚ âœ… Cooked recipes    â”‚
â”‚ âŒ NO localStorage   â”‚        â”‚ âœ… localStorage      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                   â–²
         â”‚                                   â”‚
         â–¼                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚ AIRecommendationCard â”‚                    â”‚
â”‚ âœ… Renders AI data   â”‚                    â”‚
â”‚ âœ… Correct missing   â”‚                    â”‚
â”‚ âœ… Correct ingredientsâ”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
         â”‚                                   â”‚
         â”‚ User clicks "Ugotuj"              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              (ONLY then save to RecipeContext)
```

---

## ğŸ”„ Ğ–Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ AI Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸

```
1. User opens AI Assistant
   â†“
2. API: GET /api/ai-recipe/recommendation
   â†“
3. Response â†’ AIRecommendationContext (ephemeral)
   â†“
4. UI renders from AIRecommendationContext
   â†“
5. User closes page â†’ data lost âœ… (correct)
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ°

```
1. User clicks "Ugotuj"
   â†“
2. API: POST /recipes/{id}/cook
   â†“
3. Success â†’ NOW save to RecipeContext
   â†“
4. RecipeContext â†’ localStorage âœ…
   â†“
5. User can see cooked recipe history
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 3: "Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ñ€ĞµÑ†ĞµĞ¿Ñ‚"

```
1. User clicks "OdÅ›wieÅ¼"
   â†“
2. Add current recipe ID to excludedRecipeIds
   â†“
3. API: GET /api/ai-recipe/recommendation
      + excludeRecipeIds=[...]
   â†“
4. New recommendation â†’ AIRecommendationContext
   â†“
5. UI updates with new recipe
```

---

## ğŸ“¦ Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

| Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ | ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ | Persistent? |
|----------|----------|-------------|
| ğŸ¤– ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ AI Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ | AIRecommendationContext | âŒ No |
| ğŸ‘¨â€ğŸ³ ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµÑ†ĞµĞ¿Ñ‚ | RecipeContext | âœ… Yes |
| ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ€ĞµÑ†ĞµĞ¿Ñ‚ | RecipeContext | âœ… Yes |
| ğŸ“– ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ€ĞµÑ†ĞµĞ¿Ñ‚ Ğ¸Ğ· ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ° | RecipeContext | âœ… Yes |
| ğŸ”„ Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ | AIRecommendationContext | âŒ No |
| ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ | RecipeContext | âœ… Yes |

---

## ğŸ¯ ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹

### 1. Ephemeral vs Persistent

```typescript
// âŒ ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: AI recommendation Ğ² persistent storage
localStorage.setItem('recipe', JSON.stringify(aiRecommendation))

// âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ
AIRecommendationContext â†’ ephemeral (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸)
RecipeContext â†’ persistent (localStorage)
```

### 2. Source of Truth

```typescript
// âŒ ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: UI Ğ±ĞµÑ€Ñ‘Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚
<Badge>{RecipeContext.ingredientsMissing.length}</Badge>  // â† ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
<List>{AIResponse.ingredients}</List>                     // â† Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ

// âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº
<Badge>{data.recipe.missingIngredients.length}</Badge>
<List>{data.recipe.ingredients}</List>
```

### 3. Explicit User Actions

```typescript
// âŒ ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ
useAIRecommendation(token, (data) => saveToRecipeContext(data))

// âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: ÑĞ²Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
const handleCook = () => {
  await cookRecipe()
  saveToRecipeContext(recipe)  // â† Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ
}
```

---

## ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸

### Ğ¢ĞµÑÑ‚ 1: AI Recommendation Ğ½Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
```typescript
// Given
Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ AI Assistant

// When
Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ

// Then
âœ… localStorage ĞĞ• ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ AI Ñ€ĞµÑ†ĞµĞ¿Ñ‚
âœ… RecipeContext.recipe === null (Ğ¸Ğ»Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ Ñ€ĞµÑ†ĞµĞ¿Ñ‚)
```

### Ğ¢ĞµÑÑ‚ 2: Cook ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² RecipeContext
```typescript
// Given
AI Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ "Ğ–Ğ°Ñ€ĞµĞ½Ñ‹Ğµ ÑĞ¹Ñ†Ğ°"

// When
Ğ½Ğ°Ğ¶Ğ°Ñ‚ÑŒ "Ugotuj"

// Then
âœ… RecipeContext.recipe === "Ğ–Ğ°Ñ€ĞµĞ½Ñ‹Ğµ ÑĞ¹Ñ†Ğ°"
âœ… localStorage ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ñ€ĞµÑ†ĞµĞ¿Ñ‚
```

### Ğ¢ĞµÑÑ‚ 3: UI Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
```typescript
// Given
AI Response: missing_count = 1

// When
Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ‚ÑÑ AIRecommendationCard

// Then
âœ… Badge Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ "Brakuje 1 skÅ‚adnikÃ³w"
âœ… Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ½Ğ³Ñ€ĞµĞ´Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ñƒ
âœ… ĞĞ•Ğ¢ Ğ¸Ğ½Ğ³Ñ€ĞµĞ´Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸Ğ· Ğ²ÑĞµĞ³Ğ¾ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ¸Ğ»ÑŒĞ½Ğ¸ĞºĞ°
```

---

## ğŸ“š Ğ˜Ñ‚Ğ¾Ğ³Ğ¾

**Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:**

> **AI Recommendation = Decision (ephemeral)**  
> **User Recipe = Selection (persistent)**

**ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ ÑĞ¼ĞµÑˆĞ¸Ğ²Ğ°Ñ‚ÑŒ:**
- âŒ Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ â†” ĞŸĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
- âŒ AI output â†” User input
- âŒ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ â†” Ğ¯Ğ²Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ

**ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… â€” ÑĞ²Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚, ÑĞ²Ğ¾Ñ Ğ¶Ğ¸Ğ·Ğ½ÑŒ.**
