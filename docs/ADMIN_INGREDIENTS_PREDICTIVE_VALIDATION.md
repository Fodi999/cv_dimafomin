# Admin Ingredients: Predictive Validation (UX Pro Level)

## üéØ –¶–µ–ª—å

**–ü—Ä–µ–¥—É–≥–∞–¥–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –¥—É–±–ª–∏–∫–∞—Ç–∞ –î–û –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –±–µ–∫–µ–Ω–¥**

–ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø—Ä–∏ –≤–≤–æ–¥–µ, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –æ—à–∏–±–∫–∏ –æ—Ç API.

---

## ‚úÖ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1Ô∏è‚É£ **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ**

```typescript
function normalizeIngredientName(value: string): string {
  return value
    .toLowerCase()
    .replace(/\s+/g, '')      // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã
    .replace(/[^a-z–∞-—è—ë]/gi, ''); // –¢–æ–ª—å–∫–æ –±—É–∫–≤—ã
}
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- `"–ê–±—Ä–∏–∫–æ—Å"` ‚Üí `"–∞–±—Ä–∏–∫–æ—Å"`
- `"Ice Cream"` ‚Üí `"icecream"`
- `"Pomidor!!!"` ‚Üí `"pomidor"`

–¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞, —á—Ç–æ –Ω–∞ –±–µ–∫–µ–Ω–¥–µ ‚Üí 100% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ.

---

### 2Ô∏è‚É£ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ (useMemo + onChange)**

```typescript
const existingIngredient = useMemo(() => {
  if (!name.trim() || !ingredients.length) return null;

  const normalizedInput = normalizeIngredientName(name.trim());
  
  return ingredients.find(ing => {
    const variants = [
      ing.name_en ?? ing.nameEn,
      ing.name_pl ?? ing.namePl,
      ing.name_ru ?? ing.nameRu,
      ing.name
    ].filter(Boolean);

    return variants.some(variant => 
      normalizeIngredientName(variant) === normalizedInput
    );
  });
}, [name, ingredients]);
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —è–∑—ã–∫–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- `name_pl / namePl` (Polish)
- `name_en / nameEn` (English)
- `name_ru / nameRu` (Russian)
- `name` (Fallback)

---

### 3Ô∏è‚É£ **UI-—Ä–µ–∞–∫—Ü–∏—è**

#### üü¢ –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–∞
```tsx
<Input 
  value={name}
  className="" // –û–±—ã—á–Ω–æ–µ –ø–æ–ª–µ
/>
<Button disabled={false}>–°–æ–∑–¥–∞—Ç—å</Button>
```

#### üî¥ –ù–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç
```tsx
<Input 
  value={name}
  className="border-yellow-500 focus-visible:ring-yellow-500"
/>

<div className="bg-yellow-50 p-3 rounded-md">
  <AlertCircle />
  <p>–¢–∞–∫–æ–π –ø—Ä–æ–¥—É–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:</p>
  <p><b>Morela</b> ¬∑ fruit, g</p>
  <p className="text-xs">–í–≤–µ–¥–∏—Ç–µ –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π</p>
</div>

<Button disabled={true}>–ü—Ä–æ–¥—É–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</Button>
```

---

## üìä –ß—Ç–æ –≤–∏–¥–∏—Ç –∞–¥–º–∏–Ω

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç
```
–í–≤–æ–¥: "–ö–∏–≤–∏"
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ü–æ–ª–µ –∑–µ–ª—ë–Ω–æ–µ, –∫–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î—É–±–ª–∏–∫–∞—Ç (–æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
```
–í–≤–æ–¥: "–ú–æ—Ä–∫–æ–≤—å"
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ö†Ô∏è "–¢–∞–∫–æ–π –ø—Ä–æ–¥—É–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: Marchew ¬∑ vegetable, g"
–ö–Ω–æ–ø–∫–∞: üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î—É–±–ª–∏–∫–∞—Ç (—Ä–∞–∑–Ω—ã–µ —è–∑—ã–∫–∏)
```
–í–≤–æ–¥: "Apricot"
–°—É—â–µ—Å—Ç–≤—É–µ—Ç: "Morela" (name_en: "apricot")
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ö†Ô∏è "–¢–∞–∫–æ–π –ø—Ä–æ–¥—É–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: Morela ¬∑ fruit, g"
–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: "apricot" === "apricot" ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –î—É–±–ª–∏–∫–∞—Ç (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏/–∫–∞–ø—Å–æ–º)
```
–í–≤–æ–¥: "ICE CREAM"
–°—É—â–µ—Å—Ç–≤—É–µ—Ç: "Ice Cream"
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç
–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: "icecream" === "icecream" ‚úÖ
```

---

## üß† –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. **221 –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç —É–∂–µ –≤ –ø–∞–º—è—Ç–∏**
```typescript
const { ingredients } = useIngredients(); // ‚Üê –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
```

–ù–µ –Ω—É–∂–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è.

---

### 2. **–¢–∞ –∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —á—Ç–æ –Ω–∞ –±–µ–∫–µ–Ω–¥–µ**

| –§—Ä–æ–Ω—Ç | –ë–µ–∫–µ–Ω–¥ |
|-------|--------|
| `normalizeIngredientName()` | `normalize_ingredient_name()` |
| `.toLowerCase()` | `.lower()` |
| `.replace(/\s+/g, '')` | `.replace(/\s+/g, '')` |

‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã ‚Üí –¥—É–±–ª–∏–∫–∞—Ç—ã —Ç–æ—á–Ω–æ –Ω–∞–π–¥—É—Ç—Å—è.

---

### 3. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞**

```typescript
if (existingIngredient) {
  toast.info("–≠—Ç–æ—Ç –ø—Ä–æ–¥—É–∫—Ç —É–∂–µ –µ—Å—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ");
  return; // ‚Üê –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º POST –∑–∞–ø—Ä–æ—Å
}

const res = await createIngredient(trimmedName);
```

**–≠–∫–æ–Ω–æ–º–∏—è:**
- ‚ùå –ù–µ—Ç –ª–∏—à–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚ùå –ù–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –±–µ–∫–µ–Ω–¥
- ‚ùå –ù–µ—Ç –æ—à–∏–±–∫–∏ 409
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

---

## üî• –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏ (PRO Level)

### 1Ô∏è‚É£ **Enter –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –¥—É–±–ª–∏–∫–∞—Ç–µ**

```tsx
onKeyDown={(e) => {
  if (e.key === 'Enter' && name.trim() && !existingIngredient) {
    handleSubmit();
  }
}}
```

–ï—Å–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç ‚Üí Enter –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.

---

### 2Ô∏è‚É£ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏**

```tsx
{existingIngredient ? (
  "–ü—Ä–æ–¥—É–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
) : (
  "–°–æ–∑–¥–∞—Ç—å"
)}
```

---

### 3Ô∏è‚É£ **409 –≤—Å—ë –µ—â—ë –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è (–Ω–∞ —Å–ª—É—á–∞–π race condition)**

```typescript
catch (error: any) {
  if (error?.status === 409) {
    toast.info("–≠—Ç–æ—Ç –ø—Ä–æ–¥—É–∫—Ç —É–∂–µ –µ—Å—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ");
    setOpen(false);
    return;
  }
  toast.error(error?.message);
}
```

**–ó–∞—á–µ–º?** –ù–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏:
- –î–≤–∞ –∞–¥–º–∏–Ω–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç –ø—Ä–æ–¥—É–∫—Ç
- –°–ø–∏—Å–æ–∫ –µ—â—ë –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –î–æ (–±–µ–∑ –ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏) | –ü–æ—Å–ª–µ |
|--------------------------------|-------|
| –ó–∞–ø—Ä–æ—Å ‚Üí 409 ‚Üí Toast ‚ùå | –ü—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí Toast ‚ÑπÔ∏è |
| ~500ms (—Å–µ—Ç—å + AI) | ~0ms (–ª–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞) |
| –õ–æ–≥ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ | –ù–µ—Ç –æ—à–∏–±–æ–∫ |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –ø–æ—á–µ–º—É | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å—Ä–∞–∑—É |

---

## üé® –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. **–ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ**

```tsx
{existingIngredient && (
  <Button 
    variant="link" 
    onClick={() => highlightRow(existingIngredient.id)}
  >
    –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–¥—É–∫—Ç—É ‚Üí
  </Button>
)}
```

### 2. **–£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –æ—Ç AI**

–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç "–ê–±—Ä–∏–∫–æ—Å", –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å:
- "–ê–±—Ä–∏–∫–æ—Å —Å—É—à—ë–Ω—ã–π"
- "–ê–±—Ä–∏–∫–æ—Å –∫–æ–Ω—Å–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π"
- "–ê–±—Ä–∏–∫–æ—Å –ø—é—Ä–µ"

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- ‚úÖ –§—É–Ω–∫—Ü–∏—è `normalizeIngredientName()`
- ‚úÖ `useMemo` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞
- ‚úÖ `useIngredients()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
- ‚úÖ –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ–ª—è (`border-yellow-500`)
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å `<AlertCircle>`
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ (`disabled={!!existingIngredient}`)
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Enter
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (`if (existingIngredient) return`)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ 409 (–Ω–∞ —Å–ª—É—á–∞–π race condition)

---

## üß† –ò—Ç–æ–≥

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| –ê–¥–º–∏–Ω –Ω–µ –≤–∏–¥–∏—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ | ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ |
| –õ–∏—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –±–µ–∫–µ–Ω–¥ | ‚úÖ –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ—Å–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç |
| 409 –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –æ—à–∏–±–∫–∞ | ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º info toast |
| –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –ø–æ—á–µ–º—É –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è | ‚úÖ –ß—ë—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ + —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–¥—É–∫—Ç |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–¥–º–∏–Ω —Å—Ä–∞–∑—É –ø–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –Ω–µ —Ç—Ä–∞—Ç–∏—Ç –≤—Ä–µ–º—è –Ω–∞ –æ—à–∏–±–∫–∏.

üéØ **–≠—Ç–æ PRO-level UX!**
