# üîß AuthModal Architecture Fix

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. ‚ùå initialTab –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

**–ë—ã–ª–æ:**
```tsx
const [activeTab, setActiveTab] = useState<"login" | "register">(initialTab);

useEffect(() => {
  if (isOpen) {
    setActiveTab(initialTab); // ‚ùå –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
    setError(null);
  }
}, [isOpen, initialTab]);
```

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "Zarejestruj siƒô" ‚Üí –≤–∫–ª–∞–¥–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "register"
- –ú–æ–¥–∞–ª–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ `useEffect` –Ω–∞—Å–∏–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤–∫–ª–∞–¥–∫—É –æ–±—Ä–∞—Ç–Ω–æ –≤ `initialTab`
- –í–∫–ª–∞–¥–∫–∞ ¬´–ø—Ä—ã–≥–∞–µ—Ç¬ª, UX –æ—â—É—â–∞–µ—Ç—Å—è —Å–ª–æ–º–∞–Ω–Ω—ã–º

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ:**
```tsx
const hasInitialized = useRef(false);

useEffect(() => {
  if (isOpen && !hasInitialized.current) {
    setActiveTab(initialTab); // ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
    setError(null);
    hasInitialized.current = true;
  }

  if (!isOpen) {
    hasInitialized.current = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
  }
}, [isOpen, initialTab]);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `initialTab` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑** –∑–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
- –í–∫–ª–∞–¥–∫–∞ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è—Ö –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏
- –õ–æ–≥–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –∏ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è

---

### 2. ‚ùå –†–µ–¥–∏—Ä–µ–∫—Ç –≤ /assistant –∂—ë—Å—Ç–∫–æ –∑–∞—à–∏—Ç

**–ë—ã–ª–æ:**
```tsx
await login(loginForm.email, loginForm.password);
onClose();
router.push("/assistant"); // ‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–Ω–∞–µ—Ç –ø—Ä–æ —Ä–æ—É—Ç–∏–Ω–≥
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `AuthModal` –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, **–∫—É–¥–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å**
- –≠—Ç–æ –ª–æ–º–∞–µ—Ç **–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–∞–ª–∫—É –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö —Å –¥—Ä—É–≥–∏–º–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞–º–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ:**
```tsx
interface AuthModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSuccess?: () => void; // ‚úÖ Callback –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  initialTab?: "login" | "register";
}

// –í handleLogin –∏ handleRegister:
await login(loginForm.email, loginForm.password);
onClose();

if (onSuccess) {
  onSuccess(); // ‚úÖ –í—ã–∑—ã–≤–∞–µ–º callback, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω
} else {
  router.push("/assistant"); // –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```tsx
// –í NavigationBurger.tsx
<AuthModal 
  isOpen={isAuthModalOpen} 
  onClose={() => setIsAuthModalOpen(false)}
  initialTab={authModalTab}
  onSuccess={() => router.push("/assistant")} // ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç —Å–Ω–∞—Ä—É–∂–∏
/>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞–ª **–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º**
- –ö–∞–∂–¥—ã–π —Ä–æ–¥–∏—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ —á–∏—â–µ –∏ –≥–∏–±—á–µ

---

### 3. ‚ùå showPassword –æ–±—â–∏–π –¥–ª—è login –∏ register

**–ë—ã–ª–æ:**
```tsx
const [showPassword, setShowPassword] = useState(false);
```

**–°–∏–º–ø—Ç–æ–º:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∞—Ä–æ–ª—å –≤ login (showPassword = true)
2. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ register
3. –ü–∞—Ä–æ–ª—å **—É–∂–µ –æ—Ç–∫—Ä—ã—Ç** (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —Å–±—Ä–æ—Å–∏–ª–æ—Å—å)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ:**
```tsx
useEffect(() => {
  setShowPassword(false); // ‚úÖ –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
}, [activeTab]);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É login/register –ø–∞—Ä–æ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- UX —Å—Ç–∞–ª –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ

---

### 4. ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–ª–∞ —á–∞—Å—Ç–∏—á–Ω–æ

**–ë—ã–ª–æ:**
```tsx
if (error.message === "Invalid credentials") { ... }
else if (error.status === 401) { ... } // ‚ùå fetch –Ω–µ –∫–∏–¥–∞–µ—Ç status
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `fetch` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `error.status` –Ω–∞–ø—Ä—è–º—É—é
- `axios` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `error.response.status`
- –ß–∞—Å—Ç—å —É—Å–ª–æ–≤–∏–π **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞**

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ:**
```tsx
// –ù–∞–¥—ë–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è fetch –∏ axios
const status = error?.response?.status ?? error?.status;
const message = error?.response?.data?.message ?? error?.message;

if (message === "Invalid credentials") { ... }
else if (status === 401) { ... } // ‚úÖ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–æ–∏—Ö
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç HTTP-–∫–ª–∏–µ–Ω—Ç–∞** (fetch/axios)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö**

---

## –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### ‚ùå –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- `initialTab` –ª–æ–º–∞–ª UX –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
- –ú–æ–¥–∞–ª–∫–∞ –±—ã–ª–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ä–µ–¥–∏—Ä–µ–∫—Ç—É
- –°–æ—Å—Ç–æ—è–Ω–∏–µ `showPassword` –ø—Ä–æ—Ç–µ–∫–∞–ª–æ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–ª–∞ —á–∞—Å—Ç–∏—á–Ω–æ

### ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- –õ–æ–≥–∏–∫–∞ –≤–∫–ª–∞–¥–æ–∫ —Å—Ç–∞–ª–∞ **–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞–ª **–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º**
- UX —Å—Ç–∞–ª **—Ä–æ–≤–Ω—ã–º –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º**
- –ö–æ–¥ —Å—Ç–∞–ª **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ —á–∏—â–µ**

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–ø—Ä–∏–º–µ—Ä—ã)

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç)
```tsx
<AuthModal 
  isOpen={isOpen} 
  onClose={() => setIsOpen(false)}
  initialTab="login"
/>
```

### –° –∫–∞—Å—Ç–æ–º–Ω—ã–º —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º
```tsx
<AuthModal 
  isOpen={isOpen} 
  onClose={() => setIsOpen(false)}
  initialTab="register"
  onSuccess={() => router.push("/profile")}
/>
```

### –° –∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```tsx
<AuthModal 
  isOpen={isOpen} 
  onClose={() => setIsOpen(false)}
  initialTab="login"
  onSuccess={() => {
    // –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞
    trackEvent("user_logged_in");
    showWelcomeToast();
    router.push("/dashboard");
  }}
/>
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### useRef –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
```tsx
const hasInitialized = useRef(false);
```

**–ü–æ—á–µ–º—É useRef, –∞ –Ω–µ useState?**
- `useRef` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è **—Ñ–ª–∞–≥–æ–≤** —Ç–∏–ø–∞ "—É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ"
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–Ω–¥–µ—Ä–∞–º–∏

### –ü–∞—Ç—Ç–µ—Ä–Ω callback-based architecture
```tsx
interface Props {
  onSuccess?: () => void; // Optional callback
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
if (onSuccess) {
  onSuccess();
} else {
  // –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É —Ä–æ–¥–∏—Ç–µ–ª—è
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

---

## –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
22 –¥–µ–∫–∞–±—Ä—è 2025
