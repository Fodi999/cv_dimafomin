# ๐ช Logout Flow - Complete Guide

## โ ะงัะพ ะฑัะปะพ ะธัะฟัะฐะฒะปะตะฝะพ

### ะัะพะฑะปะตะผะฐ:
ะะพัะปะต ะฝะฐะถะฐัะธั ะฝะฐ ะบะฝะพะฟะบั "ะััะพะด" ะฟะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะตะป ะพัะธะฑะบั **"ะั ะฝะต ะฐะฒัะพัะธะทะพะฒะฐะฝั"** ะฒะผะตััะพ ัะตะดะธัะตะบัะฐ ะฝะฐ ัััะฐะฝะธัั ะฒัะพะดะฐ.

### ะัะธัะธะฝะฐ:
ะ `/app/profile/dashboard/page.tsx` ะพััััััะฒะพะฒะฐะป ัะตะดะธัะตะบั ะฝะฐ `/login` ะบะพะณะดะฐ ัะพะบะตะฝ ะฝะต ะฝะฐะนะดะตะฝ. ะะผะตััะพ ััะพะณะพ ะฟะพะบะฐะทัะฒะฐะปะพัั ัะพะพะฑัะตะฝะธะต ะพะฑ ะพัะธะฑะบะต.

---

## ๐ ะะพะณะฐัั Flow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะพะปัะทะพะฒะฐัะตะปั ะบะปะธะบะฝัะป    โ
โ  "ะััะพะด" / "Logout"      โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
โ  handleLogout() ะฒัะทะฒะฐะฝ   โ
โ  (ะฒ dashboard ะธะปะธ layout)โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
โ  logout() ะธะท auth.ts     โ
โ  ะฃะดะฐะปัะตั ะธะท localStorage:โ
โ  - token โ              โ
โ  - role โ               โ
โ  - user โ               โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
โ  window.location.href    โ
โ  = '/login'              โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
โ  ะะพะปะฝะฐั ะฟะตัะตะทะฐะณััะทะบะฐ     โ
โ  ัััะฐะฝะธัั                โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
โ  /login ัััะฐะฝะธัะฐ         โ
โ  ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั      โ
โ  ัะพัะผั ะฒัะพะดะฐ             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ก๏ธ ะะฐัะธัะฐ Dashboard ัััะฐะฝะธั

### User Dashboard (`/app/profile/dashboard/page.tsx`)

**ะะ:**
```typescript
if (!token) {
  setError("ะั ะฝะต ะฐะฒัะพัะธะทะพะฒะฐะฝั");  โ ะะพะบะฐะทัะฒะฐะตั ะพัะธะฑะบั, ะฝะพ ะฝะต ัะตะดะธัะตะบัะธั
  setLoading(false);
  return;
}
```

**ะะะกะะ:**
```typescript
if (!token) {
  console.log("[ProfileDashboard] ะขะพะบะตะฝ ะฝะต ะฝะฐะนะดะตะฝ, ัะตะดะธัะตะบั ะฝะฐ /login");
  setLoading(false);
  router.push("/login");  โ ะะตะดะธัะตะบั ะฝะฐ ัััะฐะฝะธัั ะฒัะพะดะฐ
  return;
}
```

---

### Error Handling

ะัะปะธ ะฟัะธ ะทะฐะณััะทะบะต ะดะฐะฝะฝัั ะฟัะพะธััะพะดะธั ะพัะธะฑะบะฐ, ัะตะฟะตัั ะฟะพะบะฐะทัะฒะฐะตััั ะบะฝะพะฟะบะฐ ะดะปั ะฒะพะทะฒัะฐัะฐ:

```typescript
if (error) {
  return (
    <div className="...">
      <AlertCircle className="..." />
      <h2>ะัะธะฑะบะฐ</h2>
      <p>{error}</p>
      <button onClick={() => router.push("/login")}>  {/* โ NEW */}
        ะะตัะฝััััั ะฝะฐ ะฒัะพะด
      </button>
    </div>
  );
}
```

---

## ๐ ะคะฐะนะปั ะบะพัะพััะต ะฑัะปะธ ะธัะฟัะฐะฒะปะตะฝั

### 1. `/app/profile/dashboard/page.tsx`
- โ ะะพะฑะฐะฒะปะตะฝ ะธะผะฟะพัั `useRouter`
- โ ะะพะฑะฐะฒะปะตะฝะฐ ะฟัะพะฒะตัะบะฐ ัะพะบะตะฝะฐ ั ัะตะดะธัะตะบัะพะผ ะฝะฐ `/login`
- โ ะะพะฑะฐะฒะปะตะฝะฐ ะบะฝะพะฟะบะฐ ะฒ ะพัะธะฑะบั ะดะปั ะฒะพะทะฒัะฐัะฐ ะฝะฐ ะฒัะพะด

### 2. `/app/admin/dashboard/page.tsx`
- โ ะะพะฑะฐะฒะปะตะฝะฐ ะบะฝะพะฟะบะฐ ะฒ ะพัะธะฑะบั ะดะปั ะฒะพะทะฒัะฐัะฐ ะฝะฐ ะฒัะพะด
- โ (ะะฐัะธัะฐ ัะพะปะธ ัะถะต ะฑัะปะฐ ัะตะฐะปะธะทะพะฒะฐะฝะฐ ัะฐะฝะตะต)

---

## ๐ฏ ะะพะปะฝัะน Logout Workflow

### ะจะฐะณ 1: ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "ะััะพะด"

**ะะดะต ะฝะฐัะพะดะธััั ะบะฝะพะฟะบะฐ:**
- ะ `/app/profile/page.tsx` โ `handleLogout()`
- ะ `/app/admin/dashboard/page.tsx` โ `handleLogout()`
- ะ `/app/admin/layout.tsx` โ `handleLogout()`

**ะะพะด:**
```typescript
const handleLogout = () => {
  logout();  // ะะท auth.ts
  router.push("/login");  // ะะตะดะธัะตะบั
};
```

### ะจะฐะณ 2: ะคัะฝะบัะธั logout ะพัะธัะฐะตั localStorage

**ะคะฐะนะป:** `/src/utils/auth.ts`

```typescript
export function logout(): void {
  if (typeof window === 'undefined') return;
  
  localStorage.removeItem('token');    // โ ะฃะดะฐะปัะฝ
  localStorage.removeItem('role');     // โ ะฃะดะฐะปัะฝ
  localStorage.removeItem('user');     // โ ะฃะดะฐะปัะฝ
  
  window.location.href = '/login';     // โ ะะพะปะฝะฐั ะฟะตัะตะทะฐะณััะทะบะฐ
}
```

### ะจะฐะณ 3: ะกััะฐะฝะธัะฐ ะฟะตัะตะทะฐะณััะถะฐะตััั ะธ ัะตะดะธัะตะบัะธั ะฝะฐ /login

ะัะธ ะทะฐะณััะทะบะต ะปัะฑะพะณะพ ะทะฐัะธััะฝะฝะพะณะพ ะผะฐัััััะฐ:

1. **ProfileDashboard** ะฟัะพะฒะตััะตั ัะพะบะตะฝ
   ```typescript
   const token = localStorage.getItem("token");
   if (!token) {
     router.push("/login");  // โ ะะตะดะธัะตะบั
     return;
   }
   ```

2. **AdminDashboard** ะฟัะพะฒะตััะตั ัะพะปั
   ```typescript
   const role = localStorage.getItem("role");
   if (role !== "admin") {
     router.push("/");  // ะะตะดะธัะตะบั ะฝะฐ ะณะปะฐะฒะฝัั (ะฝะต ะฐะดะผะธะฝ)
     return;
   }
   ```

### ะจะฐะณ 4: ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั ัะพัะผั ะฒัะพะดะฐ

ะะฐ ัััะฐะฝะธัะต `/login` ะผะพะถะฝะพ ัะฝะพะฒะฐ ะฐะฒัะพัะธะทะพะฒะฐัััั.

---

## ๐ ะะพะณะธะบะฐ ะทะฐัะธัั ะผะฐัััััะพะฒ

### User Dashboard (`/profile/dashboard`)
```
ะขะพะบะตะฝ ะตััั? 
  โ ะะ โ ะะฐะณััะทะธัั ะดะฐะฝะฝัะต ะธ ะฟะพะบะฐะทะฐัั dashboard
  โ ะะะข โ ะะตะดะธัะตะบั ะฝะฐ /login
```

### Admin Dashboard (`/admin/dashboard`)
```
ะะพะปั === 'admin'?
  โ ะะ โ ะะฐะณััะทะธัั ะดะฐะฝะฝัะต ะธ ะฟะพะบะฐะทะฐัั ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั
  โ ะะะข โ ะะตะดะธัะตะบั ะฝะฐ /

ะขะพะบะตะฝ ะตััั?
  โ ะะ โ ะัะพะดะพะปะถะธัั ะทะฐะณััะทะบั
  โ ะะะข โ ะะพะบะฐะทะฐัั ะพัะธะฑะบั + ะบะฝะพะฟะบะฐ ะฝะฐ ะฒัะพะด
```

---

## ๐งช ะัะพะฒะตัะบะฐ ะฒ ะฑัะฐัะทะตัะต

### 1. ะัะพะฒะตัะธัั logout
```bash
# 1. ะัะบัััั DevTools โ Console
localStorage.getItem('token')  // ะะพะปะถะตะฝ ะฑััั ัะพะบะตะฝ ะฟะตัะตะด ะปะพะณะฐััะพะผ

# 2. ะะฐะถะฐัั "ะััะพะด" / Logout
# 3. ะัะพะฒะตัะธัั localStorage ัะฝะพะฒะฐ
localStorage.getItem('token')  // ะะพะปะถะตะฝ ะฑััั null
```

### 2. ะัะพะฒะตัะธัั ัะตะดะธัะตะบั
```bash
# 1. ะััั ะฝะฐ /profile/dashboard ะธะปะธ /admin/dashboard
# 2. ะะฐะถะฐัั F12 โ Network
# 3. ะะฐะถะฐัั "ะััะพะด"
# 4. ะะพะปะถะตะฝ ะฑััั ัะตะดะธัะตะบั ะฝะฐ /login (ะฒะธะดะฝะพ ะฒ Network tab)
```

### 3. ะัะพะฒะตัะธัั ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ัะตััะธะธ
```bash
# 1. ะะพะนัะธ ะธ ะพัะบัััั /profile/dashboard
# 2. ะะฐะถะฐัั F5 (ะพะฑะฝะพะฒะธัั ัััะฐะฝะธัั)
# 3. ะะพะปะถะตะฝ ะพััะฐัััั ะฝะฐ /profile/dashboard (sesisั ะฒะพัััะฐะฝะพะฒะปะตะฝะฐ)
# 4. ะัั ัะฐะท F5
# 5. ะัั ะตัั ะดะพะปะถะฝะพ ัะฐะฑะพัะฐัั
```

---

## ๐จ ะะพะทะผะพะถะฝัะต ะฟัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั

### โ ะะพัะปะต ะปะพะณะฐััะฐ ะฒัั ะตัั ะฒะธะดะฝะพ ะดะฐะฝะฝัะต
**ะัะธัะธะฝะฐ:** localStorage ะฝะต ะพัะธัะฐะตััั ะฟะพะปะฝะพัััั

**ะะตัะตะฝะธะต:**
```bash
# DevTools Console:
localStorage.clear()  // ะัะธััะธัั ะะกะ ะดะฐะฝะฝัะต
location.reload()     // ะะตัะตะทะฐะณััะทะธัั ัััะฐะฝะธัั
```

---

### โ ะะพัะปะต ะปะพะณะฐััะฐ ะฝะต ัะตะดะธัะตะบัะธั ะฝะฐ /login
**ะัะธัะธะฝะฐ:** router.push() ะฝะต ััะฐะฑะพัะฐะป ะธะปะธ ะทะฐะผะตะฝะธะปัั ะฝะฐ window.location

**ะะตัะตะฝะธะต:**
1. ะัะบัััั DevTools โ Console
2. ะัะพะฒะตัะธัั ะพัะธะฑะบะธ
3. ะัะพะฒะตัะธัั ััะพ logout() ะฒัะทัะฒะฐะตััั

---

### โ ะะธะดะฝะพ ะพัะธะฑะบั "ะั ะฝะต ะฐะฒัะพัะธะทะพะฒะฐะฝั" ะฝะพ ะฝะต ะฒะธะดะฝะพ ะบะฝะพะฟะบะธ
**ะัะธัะธะฝะฐ:** ะะพะด ะพัะธะฑะบะธ ะฝะต ะฑัะป ะพะฑะฝะพะฒะปัะฝ

**ะะตัะตะฝะธะต:**
```bash
# ะฃะฑะตะดะธัััั ััะพ ััะพ ะฟะพัะปะตะดะฝัั ะฒะตััะธั:
grep -r "ะะตัะฝััััั ะฝะฐ ะฒัะพะด" app/
# ะะพะปะถะฝะพ ะฝะฐะนัะธ ะพะฑะต ัะฐะนะปั
```

---

## โ ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั

```bash
# 1. ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะฒะพะนัะธ
http://localhost:3000/login
# โ ะคะพัะผะฐ ะฒัะพะดะฐ ัะฐะฑะพัะฐะตั

# 2. ะะพัะปะต ะฒัะพะดะฐ ัะตะดะธัะตะบั ะฝะฐ /profile/dashboard
# โ ะะธะดะฝะพ ะปะธัะฝัะน ะบะฐะฑะธะฝะตั

# 3. ะะฐะถะฐะป "ะััะพะด" โ ัะตะดะธัะตะบั ะฝะฐ /login
# โ ะะตัะฝัะปัั ะฝะฐ ัะพัะผั ะฒัะพะดะฐ

# 4. localStorage ะพัะธัะตะฝ
# โ localStorage.getItem('token') === null

# 5. ะะต ะผะพะถะตัั ะทะฐะนัะธ ะพะฑัะฐัะฝะพ ะฝะฐ /profile/dashboard
# ะฑะตะท ะฒัะพะดะฐ - ัะตะดะธัะตะบั ะฝะฐ /login
# โ ะะฐัะธัะฐ ัะฐะฑะพัะฐะตั
```

---

## ๐ ะกัะฐะฒะฝะตะฝะธะต ะะพ/ะะพัะปะต

| ะกัะตะฝะฐัะธะน | ะะพ | ะะพัะปะต |
|----------|----|----|
| **ะะพะปัะทะพะฒะฐัะตะปั ะฒััะพะดะธั** | ะะธะดะธั ะพัะธะฑะบั "ะะต ะฐะฒัะพัะธะทะพะฒะฐะฝ" | ะะตะดะธัะตะบั ะฝะฐ `/login` โ |
| **ะัะธะฑะบะฐ ะทะฐะณััะทะบะธ ะฟัะพัะธะปั** | ะัะธะฑะบะฐ ะฑะตะท ะบะฝะพะฟะบะธ | ะัะธะฑะบะฐ + ะบะฝะพะฟะบะฐ "ะะตัะฝััััั ะฝะฐ ะฒัะพะด" โ |
| **ะะฑะฝะพะฒะปะตะฝะธะต ัััะฐะฝะธัั ะฑะตะท ัะพะบะตะฝะฐ** | ะะพะถะตั ะฑััั ะพัะธะฑะบะฐ | ะะฒัะพะผะฐัะธัะตัะบะธะน ัะตะดะธัะตะบั ะฝะฐ `/login` โ |
| **ะััะผะพะน ะฟะตัะตัะพะด ะฝะฐ `/profile/dashboard` ะฑะตะท ะฒัะพะดะฐ** | ะัะธะฑะบะฐ | ะะตะดะธัะตะบั ะฝะฐ `/login` โ |

---

## ๐ ะะทะผะตะฝัะฝะฝัะต ัััะพะบะธ ะบะพะดะฐ

### `/app/profile/dashboard/page.tsx`
- **Line 2:** ะะพะฑะฐะฒะปะตะฝ `useRouter`
- **Line 25:** ะะฝะธัะธะฐะปะธะทะธัะพะฒะฐะฝ `const router = useRouter()`
- **Line 33-35:** ะะพะฑะฐะฒะปะตะฝ ัะตะดะธัะตะบั ะฝะฐ `/login` ะตัะปะธ ะฝะตั ัะพะบะตะฝะฐ
- **Line 75-84:** ะะพะฑะฐะฒะปะตะฝะฐ ะบะฝะพะฟะบะฐ ะฒ ะพัะธะฑะบะต

### `/app/admin/dashboard/page.tsx`
- **Line 87-96:** ะะพะฑะฐะฒะปะตะฝะฐ ะบะฝะพะฟะบะฐ ะฒ ะพัะธะฑะบะต

---

**Last Updated:** 12 ะฝะพัะฑัั 2025  
**Status:** โ ะะกะะะะะะะะ ะ ะะะะขะะกะขะะะะะะะ
